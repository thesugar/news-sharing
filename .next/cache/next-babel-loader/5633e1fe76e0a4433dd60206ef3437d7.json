{"ast":null,"code":"var _jsxFileName = \"/Users/RyoheiSato/news-sharing/components/SelectWho.js\";\nvar __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Router from 'next/router';\nimport firebase from \"firebase\";\nimport SimpleModal from '../components/Modal';\n\nclass SelectWho extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"getUserList\", (self = this) => {\n      console.log('now inside getUserList function');\n      let db = firebase.firestore(); // firestore のオブジェクト取得\n\n      db.collection('news-user').get().then(function (querySnapshot) {\n        let userList = [];\n        querySnapshot.forEach(doc => {\n          // doc.data() is never undefined for query doc snapshots\n          console.log(doc.id, \" => \", doc.data());\n          userList.push(__jsx(\"li\", {\n            key: doc.id,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 60\n            },\n            __self: this\n          }, __jsx(\"input\", {\n            type: \"checkbox\",\n            onChange: e => self.onChecked(doc.data().userid, e),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 60\n            },\n            __self: this\n          }), doc.data().userid));\n        });\n        self.setState({\n          userList: userList\n        });\n      });\n    });\n\n    _defineProperty(this, \"onChangeText\", e => {\n      this.setState({\n        textAreaValue: e.target.value\n      });\n    });\n\n    _defineProperty(this, \"doAction\", (article, userid, e) => {\n      console.log('doActionの中');\n      console.log('userid is');\n      console.log(userid);\n      let db = firebase.firestore(); // Firestore の登録処理\n\n      db.collection('share').add({\n        title: article.title,\n        description: article.description,\n        image: article.urlToImage,\n        url: article.url,\n        sharedFrom: userid,\n        sharedTo: this.state.currentSelectedUsers,\n        comment: this.state.textAreaValue // コメントへの返信を実装するときにはcommentを配列にする（か都度フィールドを追加する？），コメントへのいいねを実装するならネストJSONにする?\n\n      }).then(doc => {\n        console.log(`共有しました`);\n        this.setState({\n          success: true,\n          afterClicked: true,\n          textAreaValue: ''\n        });\n        setTimeout(this.setState({\n          success: false,\n          afterClicked: false\n        }));\n      }).catch(error => {\n        console.log(`共有に失敗しました。リトライしてください。`);\n        this.setState({\n          success: false,\n          afterClicked: true\n        });\n        setTimeout(this.setState({\n          success: false,\n          afterClicked: false\n        }));\n      });\n      this.setState({\n        title: '',\n        description: '',\n        image: '',\n        url: '',\n        sharedFrom: '',\n        sharedTo: '',\n        comment: ''\n      });\n    });\n\n    if (this.props.login == false) {\n      Router.push('/');\n    }\n\n    this.state = {\n      userList: [],\n      textAreaValue: '',\n      success: true,\n      afterClicked: false\n    };\n    this.logined = this.logined.bind(this);\n    this.onChecked = this.onChecked.bind(this);\n    this.doAction = this.doAction.bind(this);\n    this.onChangeText = this.onChangeText.bind(this);\n  } // login, logout 処理\n\n\n  logined() {\n    console.log('logined.');\n  }\n\n  logouted() {\n    Router.push('/');\n  }\n\n  onChecked(userid, e) {\n    const currentSelectedUsers = this.state.currentSelectedUsers ? this.state.currentSelectedUsers : [];\n    currentSelectedUsers.push(userid); // はまりポイント：\n    // 以下で {currentSelectedUsers : currentSelectedUsers.push(userid)}としたら\n    // currentSelectedUsers に 1 という数字が入って配列じゃないためpushできないという現象\n    // Array.push は 戻り値として length を返すため\n\n    e.target.checked ? this.setState({\n      currentSelectedUsers: currentSelectedUsers\n    }) : this.setState({\n      currentSelectedUsers: currentSelectedUsers.filter(elem => elem !== userid)\n    });\n  }\n\n  render() {\n    const article = this.props.article;\n    const userid = this.props.userid;\n    (this.state.userList.length === 0 || this.state.userList === undefined) && this.getUserList();\n    const userList = this.state.userList;\n    console.log('renderの中でuserListがとれてるか');\n    console.log(userList);\n    return __jsx(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }, __jsx(\"ul\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, userList), __jsx(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, __jsx(\"textarea\", {\n      value: this.state.textAreaValue,\n      onChange: this.onChangeText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    })), __jsx(\"button\", {\n      onClick: e => this.doAction(article, userid, e),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, \"\\u78BA\\u5B9A\"), this.state.afterClicked && this.state.success ? __jsx(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    }, __jsx(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, \"\\u5171\\u6709\\u3057\\u307E\\u3057\\u305F\")) : this.state.afterClicked && !this.state.success ? __jsx(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }, __jsx(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, \"\\u5171\\u6709\\u306B\\u5931\\u6557\\u3057\\u307E\\u3057\\u305F\")) : null) // 共有先はここでモーダル（ポータル）を表示して選べるようにする\n    ;\n  }\n\n}\n\nSelectWho = connect(state => state)(SelectWho);\nexport default SelectWho;","map":{"version":3,"sources":["/Users/RyoheiSato/news-sharing/components/SelectWho.js"],"names":["React","Component","connect","Router","firebase","SimpleModal","SelectWho","constructor","props","self","console","log","db","firestore","collection","get","then","querySnapshot","userList","forEach","doc","id","data","push","e","onChecked","userid","setState","textAreaValue","target","value","article","add","title","description","image","urlToImage","url","sharedFrom","sharedTo","state","currentSelectedUsers","comment","success","afterClicked","setTimeout","catch","error","login","logined","bind","doAction","onChangeText","logouted","checked","filter","elem","render","length","undefined","getUserList"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport { connect } from 'react-redux';\nimport Router from 'next/router';\nimport firebase from \"firebase\";\nimport SimpleModal from '../components/Modal'\n\nclass SelectWho extends Component {\n\n    constructor(props){\n        super(props);\n        if (this.props.login == false) {\n            Router.push('/');\n        }\n        this.state = {\n            userList : [],\n            textAreaValue : '',\n            success : true,\n            afterClicked : false\n        }\n\n        this.logined = this.logined.bind(this);\n        this.onChecked = this.onChecked.bind(this);\n        this.doAction = this.doAction.bind(this);\n        this.onChangeText = this.onChangeText.bind(this);\n    }\n\n    // login, logout 処理\n    logined(){\n        console.log('logined.');\n    }\n\n    logouted(){\n        Router.push('/');\n    }\n\n    onChecked(userid, e) {\n        const currentSelectedUsers = this.state.currentSelectedUsers ? this.state.currentSelectedUsers : [];\n        currentSelectedUsers.push(userid)\n        // はまりポイント：\n        // 以下で {currentSelectedUsers : currentSelectedUsers.push(userid)}としたら\n        // currentSelectedUsers に 1 という数字が入って配列じゃないためpushできないという現象\n        // Array.push は 戻り値として length を返すため\n        e.target.checked ? \n        this.setState({currentSelectedUsers : currentSelectedUsers})\n        :\n        this.setState({currentSelectedUsers : currentSelectedUsers.filter(elem => elem !== userid)})\n    }\n\n    getUserList = (self = this) => {\n        console.log('now inside getUserList function');\n        let db = firebase.firestore(); // firestore のオブジェクト取得\n    \n        db.collection('news-user')\n        .get()\n        .then(function(querySnapshot) {\n            let userList = [];\n            querySnapshot.forEach((doc) => {\n            // doc.data() is never undefined for query doc snapshots\n            console.log(doc.id, \" => \", doc.data());\n            userList.push(<li key={doc.id}><input type=\"checkbox\" onChange={(e) => self.onChecked(doc.data().userid, e)} />{doc.data().userid}</li>);\n            })\n            self.setState({userList: userList});\n        });\n    }\n\n    onChangeText = e => {\n        this.setState({textAreaValue: e.target.value});\n    }\n\n    // データの登録処理\n    doAction = (article, userid, e) => {    \n        console.log('doActionの中');\n        console.log('userid is');\n        console.log(userid);\n        let db = firebase.firestore();\n        // Firestore の登録処理\n\n        db.collection('share').add({\n            title: article.title,\n            description: article.description,\n            image: article.urlToImage,\n            url: article.url,\n            sharedFrom: userid,\n            sharedTo : this.state.currentSelectedUsers,\n            comment : this.state.textAreaValue // コメントへの返信を実装するときにはcommentを配列にする（か都度フィールドを追加する？），コメントへのいいねを実装するならネストJSONにする?\n        })\n        .then((doc) => {\n            console.log(`共有しました`);\n            this.setState({success: true, afterClicked: true, textAreaValue: ''});\n            setTimeout(this.setState({success: false, afterClicked: false}));\n        })\n        .catch((error) => {\n            console.log(`共有に失敗しました。リトライしてください。`);\n            this.setState({success: false, afterClicked: true});\n            setTimeout(this.setState({success: false, afterClicked: false}));\n        });\n\n        this.setState({\n            title: '',\n            description: '',\n            image: '',\n            url: '',\n            sharedFrom : '',\n            sharedTo : '',\n            comment : ''\n        })\n    }\n\n    render(){\n        const article = this.props.article;\n        const userid = this.props.userid;\n        (this.state.userList.length === 0 || this.state.userList === undefined) && this.getUserList();\n        const userList = this.state.userList;\n        console.log('renderの中でuserListがとれてるか')\n        console.log(userList);\n        return (\n            <div>\n                <ul>{userList}</ul>\n                <div>\n                <textarea value={this.state.textAreaValue} onChange={this.onChangeText} />\n                </div>\n                <button onClick={(e) => this.doAction(article, userid, e)}>確定</button>\n                {this.state.afterClicked && this.state.success ? \n                <div>\n                    <p>共有しました</p>\n                </div>\n                :\n                this.state.afterClicked && !this.state.success ?\n                <div>\n                    <p>共有に失敗しました</p>\n                </div>\n                :\n                null\n                }\n            </div>\n            // 共有先はここでモーダル（ポータル）を表示して選べるようにする\n        );\n    }\n}\n\nSelectWho = connect((state) => state) (SelectWho);\nexport default SelectWho;"]},"metadata":{},"sourceType":"module"}